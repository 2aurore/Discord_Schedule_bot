name: Weekly Discord Message

on:
  schedule:
    # ë§¤ì£¼ í† ìš”ì¼ ì˜¤í›„ 1ì‹œ ë°œì†¡ (UTC ê¸°ì¤€, í•œêµ­ ì‹œê°„ì€ 13:00)
    # cron: 'ë¶„ ì‹œ ì¼ í†  ìš”ì¼'
    - cron: '0 4 * * 6'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ í™œì„±í™”

jobs:
  send_message:
    runs-on: ubuntu-latest
    steps:
      - name: Get Current Date and Day
        id: date
        run: |
          # í•œêµ­ ì‹œê°„(KST) ê¸°ì¤€ìœ¼ë¡œ ì‹¤í–‰ì¼(í† ìš”ì¼)ë¡œë¶€í„° 'ë‹¤ìŒ ìˆ˜ìš”ì¼' ê³„ì‚°
          # 'next wednesday' ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ê°€ì¥ ê°€ê¹Œìš´ ë¯¸ë˜ì˜ ìˆ˜ìš”ì¼ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
          TARGET_DATE=$(TZ='Asia/Seoul' date -d "next wednesday" +'%Y-%m-%d')
          
          # í™˜ê²½ ë³€ìˆ˜ì— ì €ì¥ (ìˆ˜ìš”ì¼ì´ë¯€ë¡œ ìš”ì¼ì€ 'ìˆ˜'ë¡œ ê³ ì •)
          echo "formatted_date=${TARGET_DATE} ìˆ˜" >> $GITHUB_ENV

      - name: Create Forum Thread
        env:
          FORMATTED_DATE: ${{ env.formatted_date }}
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          PAYLOAD=$(cat <<EOF
          {
            "thread_name": "[ì¼ì • ê³µì§€] ${FORMATTED_DATE} ì¼ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”!",
            "content": "ğŸ“… <@&1455862575765000274> **ëŒì•„ì˜¤ëŠ” ì£¼ ì¼ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”!**\n\n> ì¼ì • ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš° ë³¸ í¬ìŠ¤íŠ¸ì— ëŒ“ê¸€ì„\n> **ì›”ìš”ì¼ ì˜¤í›„ 6ì‹œ**ê¹Œì§€ ë‚¨ê²¨ì£¼ì„¸ìš” <:FKK_D_03:1456136749968265310>\n\nì´í›„ ê¸‰í•œ ë³€ê²½ ì‚¬í•­ì€ ë³„ë„ë¡œ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!\n\n**ğŸ“Œ ê¸°ì¡´ ì •ê¸° ì¼ì •**\n- ë§¤ì£¼ ìˆ˜ìš”ì¼ ì˜¤í›„ 9ì‹œ 30ë¶„"
          }
          EOF
          )
          curl -X POST "${WEBHOOK_URL}?wait=true" \
            -H "Content-Type: application/json" \
            -d "${PAYLOAD}"
