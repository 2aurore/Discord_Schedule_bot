name: Weekly Discord Message
on:
  schedule:
    - cron: '0 4 * * 6'
  workflow_dispatch:
jobs:
  send_message:
    runs-on: ubuntu-latest
    steps:
      - name: Get Current Date and Day
        id: date
        run: |
          TARGET_DATE=$(TZ='Asia/Seoul' date -d "next wednesday" +'%Y-%m-%d')
          echo "formatted_date=${TARGET_DATE} ìˆ˜" >> $GITHUB_OUTPUT
          
      - name: Create Forum Thread
        env:
          FORMATTED_DATE: ${{ steps.date.outputs.formatted_date }}
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          TAG_SCHEDULE:"1475832651280551977"
          
          PAYLOAD=$(cat <<EOF
          {
            "thread_name": "[ê³µì§€] ${FORMATTED_DATE} ì¼ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”!",
            "content": "ğŸ“… <@&1455862575765000274> **ëŒì•„ì˜¤ëŠ” ì£¼ ì¼ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”!**\n\n> ì¼ì • ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš° ë³¸ í¬ìŠ¤íŠ¸ì— ëŒ“ê¸€ì„\n> **ì›”ìš”ì¼ ì˜¤í›„ 6ì‹œ**ê¹Œì§€ ë‚¨ê²¨ì£¼ì„¸ìš” <:FKK_D_03:1456136749968265310>\n\nì´í›„ ê¸‰í•œ ë³€ê²½ ì‚¬í•­ì€ ë³„ë„ë¡œ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!\n\n**ğŸ“Œ ê¸°ì¡´ ì •ê¸° ì¼ì •**\n- ë§¤ì£¼ ìˆ˜ìš”ì¼ ì˜¤í›„ 9ì‹œ 30ë¶„",
            "applied_tags": ["${TAG_SCHEDULE}"]
          }
          EOF
          )
          curl -X POST "${WEBHOOK_URL}?wait=true" \
            -H "Content-Type: application/json" \
            -d "${PAYLOAD}"
